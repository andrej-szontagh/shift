///////////////////////////////////////////////////////////////////////////////
// TO DO SHIT STACK
//
///////////////////////////////////////////////////////////////////////////////
// OVERALL
//
// - BUSH prototype mesh and texture
//
// - FIX GRASS LOD, use more different textures (now all sides use the same one)
//   	make sure there are seamless lod switches
//
// - TREE prototype mesh and texture
//
// - MAKE LOD FOR ALL GEOMETRY
//
// - SOLVE POOR DISTANT VIEWS (missing grass)
//
// - ADD CONTROL FOR SHADOWING IN REALTIME
//
//	- NUMBER OF SPLITS
//      - SPLIT SCHEME CURVE
//      - WIDTH OF TRANSITIONS
//      - NUMBER OF SAMPLES FOR FILTERING
//      - RESOLUTION OF SHADOWMAP
//
// - ADD LOD CONTROL ON FLY 
//      - MULTIPLIER FOR ALL LOD DISTANCES OR OBJECT DISTANCES TO ACHIEVE LOD ADJUSTMENT
//
// - TRY SUN MOVEMENT
//
// - GET PANORAMATIC HDR SKY TEXTURE
//
// - ADD OPTION TO USE MULTIPLE OBJECTS IN ONE PARTICLE SYSTEM
//        - SAVES AMOUNT OF FILES PRODUCED
//        - SIMPLICITY OF HANDLING
//        - SIMPLICITY OF RENDERING (JUST CHANGE LIST NUMBER)
//        - OVERLAPPING CONTROL
//	- MAKE RESEARCH OF POSIBILITIES IN BLENDER
//
// - ADD SCRIPT TO REMOVE COLLIDING GENERATED GEOMETRY
//
// - FIND THE WAY HOW TO REMOVE COLLISION OF GASS WITH STONES AND OTHER OBJECTS
//
// - ADD GAMMA CORRECTION TO ALL INPUT INTENSITY VALUES AND COLORS (AMBIENT, FOG ..)
//	- THIS SHOULD ALLOW SWITCHING GAMMA ON/OFF WITHOUT CORRUPTED RESULT
//
///////////////////////////////////////////////////////////////////////////////
// BLENDER
//
//  *** SPLITTING DO NOT COPY CUSTOM PROPERTIES FOR CREATED MESHES !!!!!!!!!!!!!!!!!!
//
//  *** ADD CONTROL PROPERTIES TO MESH EXPORTER ADDON TO CONTROL TRESHOLDS FOR UV AND NORMALS
//      NOW ARE CONSTANTS IN CODE !!
//
//  *** WHEN CONVEX HULL IS GENERATED -> TRIANGLE STRIPS HAVE TOO MANY INDICES (??)
//      WHEN USING MORPHREDUCE        -> TRIANGLE STRIPS HAVE TOO MANY INDICES (??)
//
//  *** ANGLE ON MORPHREDUCE WORKS WRONG, LOOK AT TERRAIN IN SOME PARTS THAT ARE NOT REDUCED
//
//  *** MAKE SPECIAL MODULE THAT WILL HOLD ROUTINES THAT ARE USED WITH ALL ADDONS
//	- MULTIPLE OBJECTS HANDLING AND LOG ARE ALWAYS THE SAME AND SHOULD BE SAME
//	- REGULAR EXPRESSION HANDLING IS ALWAYS THE SAME AND SHOULD BE SAME
//	- NORMALS PRESERVING -||-
//	- PARTS OF GUI WITH SPLIT FOR REGULAR EXPRESSIONS -||-
//	- PARTS OF GUI THAT USE LABEL + VALUE STYLE
//
//  *** ADD TO GENERATE TWO PROPERTIES TO SET UV1 and UV2 CHANNELS NAMES 
//
//  *** ADD ABILITI TO CHANGE POSTFIX TO REDUCE !!!
//  *** NAMEING TO SPLIT
//  *** NAMING TO MORPH
//  *** ADD EXPRESSION PARSING AS INCLUDE MODULE
//  *** ADD EXPRESION PARSING AND NAME SETTING FROM CONVEX-HULL TO INSTANCE GENERATOR
//
//  *** ADD DESCRIPTION STRING TO ALL OPERATORS OF ALL SHIFT ADDONS
//
//  *** MAKE GUIDE HOW TO MAKE LODS IN BLENDER !!!!!!!!
//
//  *** MORPHREDUCE
//
//  *** - MAKE ITERATIONS WORK !!!!!!!!!!!!!!!!!!!!!!!!!!!
//
//      - ADD ABILITY TO ADD FORMATTED STRING TO SET NAMES OF NEW OBJECTS
//      - ADD ABILITY TO USE SPECIFIC VERTEX GROUP RATHER THEN USING SELECTED VERTICES
//  ***	- RESULS IS MUCH WORSE WHEN SET MORE THAN 1 ITERATIONS COMPARE TO ITERATING MANUALLY !!
//    * - CONSIDER reduce -> generate -> morph -> optimize  IN ONE !!
//      - ADD MESH-TOOL TO REDUCTING SELECTED FACES OR VERTICES
//          - result is mesh with the same number of vertices and faces
//            but some vertices are on the same position and some faces are degenerated
//            after optimize is reduced mesh
//
//    * FILE EXPORTERS DO NOT WORK WITH RELATIVE PATHS (CHECK ALL PATH HANDLING) !!!!
//
//  *** CONVEX HULL HAVE TOO MANY STRIP INDICES - FIND OUT WHY AND FIX IT !
//
//		WHILE LOADER DETECTS MESH THAT HAVE TOO MANY FACES SUBDIVIDE IT TO SMALLER MESHES WHILE PRESERVING SMOOTHED NORMALS
//
//			- USE OCT-TREE that holds polygons (triangles)
//			- THAN CONVERT TO STRIPS
//
//	CONSIDER USING SELECTION NON-MANIFOLD VERTICES IN STITCH NORMALS FUNCTION INSTEAD OF DOING IT IN PYTHON
//
//
///////////////////////////////////////////////////////////////////////////////
// SHIFT
//
//  - add option for special model used on shadowing or set starting minimal LOD used when shadowing (for grass)
//  - add option to set shadow rendering skipping for instanced objects (use factor and array of random nubmers if applicable)
//
//
//
//  *** CONSIDER GEOMETRY RENDERING IN MULTIPLE PASSES, EACH MATERIAL HAS ITS PASS NUMBER. SO YOU CAN CONTROLL THE ORDER OF RENDERING 
//	etc. GRASS/TERRAIN/ order. THEY ARE PROCESSED IN ORDER OF MATERIALS ARE TAKEN, 
//	BUT SOMETHIMES WE WANT SPECIFIC ORDER TO IMPROVE PERF.
//
//  *** SPECULAR HIGHLIGHT ALIASING APPEARS .. READ ABOUNT NORMALMAPPING - SOLIVING THIS PROBLEM (IS CAUSED BY NORMALMAP)
//
//  *** OBJECT FLAGS ADDED DURING EXPORT !! (DISPLAY LIST - AUTOMATICLY)
//
//  *** TERRAIN WITH MORPHING AND TERRAIN WITHOUT MORPHING ARE TWO DIFFERENT MODELS SO THEY HAVE TO BE SORTED THAT WAY ??
//
//  *** CONSIDER SORTING GRASS ONLY FOR NEARBY OBJECTS (NO SPECIAL CLIPPING TRY DIVIDING INTO SMALLER OBJECTS INSTEAD)
//
//  *** CONSIDER AND TRY ! TO SORT ONLY BY DISTANCE (IGNORE MODEL) FOR DEPTH PASS,  AND COMPARE PERFORMANCE !!!!!!!!!!!!!!!!!!!!!!!!!!
//
//  *** consider which parts of rendering states should be set in drRender body and which in draw functions !!! to make it more clear
//
//  *** USE PBO FOR AUTOEXPOSURE INTENSITY READBACK (CHECK FOR CPU STALL !!, consider using one from previous frame)
//
//  *** USE PBO FOR UPLOADING TEXTURES INTO GPU MEMORY !! (THROUGH DMA SHOULD BE FASTER)
//
//  *** CONSIDER RENDERING OCCLUDERS IN FULL RES. SO WE DONT HAVE TO RENDER THEM TWICE !! (DEPTH PASS)
//		- FOR OCCLUSION CULLING WE CAN USE DOWNSCALED VERSION
//
//  *** LOD AND OCCLUSION MESHES SHOULD BE PROPERTY OF MODEL NOT OBJECT !!!!!!!!!!!!!!!!!!!!!!!!!!!
//	- PROBLEM WITH PARTICLE OBJECTS
//		- EACH PARTICLE OBJECT SHOULD HAVE ITS OWN OCCLUSION (????)
//
//  *** EVERY OBJECT HAVE ITS OWN DETAIL BUT MAYBE IT SHOULD HAVE BE ONLY PER MODEL
//
//  *** CONSIDER USING NOT AA BOX FOR CLIPPING OBJECTS (TRY IT !)
//
//  *** ENSURE THAT NO SHADOW 'WASTE' IS USED BEHIND THE LAST SPLIT (CAUSE OF NOT CLEARING WHOLE SHADOWMAP)
//
//  *** CONSIDER NOT SETTING DISTANCE AND LOD TO OBJECTS THAT ARE TOO FAR 
//
//  *** CONSIDER USING ONLY SHADOW OBJECTS LIST FOR VIEW TOO ALL CLIPPED IN SAME PROCESS JUST MARK VISIBLE OBJECT AND OBJECTS VISIBLE ONLY FOR SUN
//
//  *** WHEN SHADOWS IS ENABLED WE SET LOD ON ALL SHADOWED OBJECTS, WHEN SHADOWS ARE OFF WE SET LOD ON ALL VISIBLE OBJECTS
//
//  *** USING OF PARTICLE GRASS AND ONE OBJECT GRASS CAUSES CRASH (TRY TO DRAW VBO WITHOUT CONTEXT SETUP CAUSE IT IS DISPLAY_LIST !!!!!! NOT Count > 1)
//
//  *** CONSIDER USING SHORT VERTEX COORDS FOR GRASS !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
//
//  *** SAVE CLIP OBJECT CLIPPING STATUS : INSIDE (ALL), COLIDING SO WE CAN SKIP ADDITIONAL CLIPPING IN ULTRA RENDERING LOOP
//
//      HOW TO SPEED UP GRASS :
//
//         - Use quads instead of triangle strips (???) 							HELPED !!!!!!!!!!!!!!!!!!!!!!!!!!!!
//	   - try additional clipping inside of loop 								HELPED !!!!!!!!!!!!!!!!!!!!!!!!!!!!
//         - oprimize area of mesh with image and area with invisible pixels (minimize invisible pixels !!) 	HELPED !!!!!!!!!!!!!!!!!!!!!!!!!!!!
//         - try to implement grass as a big mesh (like previous grass) and compare 				HELPED !!!!!!!!!!!!!!!!!!!!!!!!!!!!
//
//	NEXT STEP :
//
//		- ADD SUPPORT FOR QUADS AND TRIANGLES INTO MESH EXPORTER AND ENGINE !!!
//		- CONSIDER OF SORTING GRASS (RIGHT BEFORE RENDER ? OR SEPARATELY WITH OTHER PARTICLES ?)
//		- AFTER ADDING SUPPORT FOR QUADS COMPARE SPEED OF BIG MESHES / INSTANCED
//		- FOR GRASS USE DISPLAY LIST FASTER FOR INSTANCING THEN VBO CALLS
//
//		- TRY USING 6 FLOATS FOR ROTATION (COS/SIN PRECOMPUTED) AND COMPARE PERFORMANCE WITH (3 FLOAT ROTATION)
//
//
//  *** AVOID OF CHANGING TEXTURE SLOTS WITH THE SAME TEXTURE !! (FOR EXAMPLE ON TERRAINS WITH DIFFERENT COMBINATION OF THE SAME TEXTURE SET)
//
//    * GLOSS ON GRASS SEEMS NOT WORKING
//
//    * CONSIDER RECONTRUCTING MATRICES ON PARTICLE OBJECTS FROM :
//
//           - rotation x,y,z euler angles   -> 3 floats
//           - translation x, y, z           -> 3 floats
//           - scale                         -> 1 float
//           - SUM                           -> 7 float INSTEAD of 16 !!!
//
//           - MATRIX :
//                - translation & scale      -> SIMPLE
//                - rotation:
//                         - http://www.fastgraph.com/makegames/3drotation/
//                             - Other Ways to Build a Rotation Matrix -> mix first two matrices
//
//
//    * SOME Z-FIGHT LIKE SHIMMERING FOUND ON GRASS / BASIC MATERIAL MODEL SPECULAR / .. ?
//		- THIS IS SPECULAR PROBLEM !!!!! (CODING/ENCODING OF SPECULAR FROM G-BUFFERS MAYBE)
//
//    * CONSIDER NOT USING OF CONVEX-HULLS FOR OCCLUSION-CULLING. USE LITTLE CUBES OF SAME SIZE OF VOXEL SPACE (NO NEED OF MATRIX FOR EVERY CUBE)
//	- GENERATING CONVEX-HULLS IS TIME CONSUMING, USING THEM IS MEMORY CONSUMING AND IT EATS BANDWIDTH BECAUSE IS A LOT OF UNIQUE MESHES
//      - PLUS IT MAKES BIG OVERDRAW IN OCCLUSION CULLING BUFFER
//
//    * CONSIDER OF CONTROLLING MAXIMUM MIP-MAP LOD FOR TEXTURES TO SAVE BANDWIDTH (ALA UNREAL)
//
//    * OCCLUSION CULLING OF OBJECTS THAT ARE TOO FAR LIKE GRASS SO LOD MAKES THEM INVISIBLE CAN BE SKIPPED !!
//
//    * MISSING SSAO ON GRASS (CAUSE THEY HAVE UPWARD NORMALS)
//
//    * USE EARLY-Z ON FULL-RES SSAO
//
//   ** MAKE FORWARD RENDERER FOR RENDERING BLENDED OBJECTS
//      - NEED TO SPLIT OBJECTS FOR SEPARATE SPLIT RENDERING
//      - USE CLIP TO CLIP OBJECTS IN SUB-FRUSTUMS
//          - CONSIDER IMPROVING CLIPPER USING PREVIOUS DATA (HOPE, LESS CLIPPING)
//
//  *** CONSIDER CONTROLLING GLOBAL STATES LIKE IN dr_Draw
//
//  *** FIX ERROR WITH BLACK BULLSHIT ON THE SCREEN ON THE FIRST RUN
//          - PROBLEM IS IN BILATERAL BLURRING - DO NOT USE G-BUFFERS USE REGULAR DEPTH (BECAUSE THAT IS ONLY CLEARED ALL PIXELS)
//
//   **	CONSIDER CLIPPING SHADOWMAPS OBJECTS BINARY WAY. FIRST ALL TOGETHER AND THEN DIVIDE TO SMALLER PARTS 
//		SO YOU DONT NEED TO CLIP ALL OBJECTS. (CLIPPER HAVE TO BE EXTENDED TO TEST OBJECTS THAT HAVE SPECIFIC STAMP OR SOMETHING)
//
//   ** USE SIMPLE MESH INSTEAD OF CONVEX-HULL FOR OCCLUSION CULLING
//
//      CONSIDER MAKE SORTING BY SOME SPECIFIC KEY IN DATA (LIKE IN PHYTON, LEAVEING MAKEING SPECIAL LISTS)
//
//   ** FIX UP SUN RENDERER MODULE
//
//      WE CAN SORT BY DISTANCE USING CLIPPING INFORMATION, OBJECTS ARE INSIDE OF CLUSTERS AND THAT CAN SPEED UP SORTING
//
//   ** REDUCE VARYINGs THEY ARE INTERPOLATED FOR EACH PIXEL
//          - use build-in varying !!
//
//      ADD MORE DETAIL CONTROL
//      MAKE DETAIL CONTROL DYNAMIC
//
//    * CONSIDER RECCONECTING CLIPPING WITH OCCLUSION CULLING
//          - RENDERS WHOLE CLUSTERS LIKE BOXES AND IF BOX IS NOT RENDERED YOU CAN SKIP ALL OBJECTS
//          - YOU HAVE TO WAIT FOR RESULT SO THINK MUCH
//
//
//		USE QUICKSORT INSTEAD OF STUPID COMPARING AND SWITCHING ONE WAY ,,,		
//
//		MEMORY MANAGER (override malloc)
//		TIME MANAGEMENT
//
//      THERE IS A MESS WITH TRANSFORMATION MACROS
//
//	 	UNLOADING GPU
//
//   ** USE TEXTURE ATLASES !!!!!!!!!!
//      - you can use it for terrain textures
//        you can still combine only 3 different textures but you dont have to switch 
//        context and it can have all terrain textures on one mesh without cutting mesh
//
//   ** BUILD MATRIX THAT WILL TRANSFORM TO SHADOWMAP FROM CAMERA VIEW SPACE INSTEAD OF WORLD SPACE
//      - we use build fog in sun shader so we need world position or can we build fog different way ???
//
//      CONSIDER REMOVING UNNECESSARY MATRIX SETTINGS AND PUSH/POP OPERATIONS (matrices are used in shaders so they have to be sent to GPU)
//
//      16 bit FOR vertices ?
//          - we can use some scale param for terrain shader
//
//   ** USE OBJECT SPACE NORMALMAPS FOR ASSETS (TREES, ROCKS), WE CAN THROW AWAY NORMALS AND TANGENTS AND ALL CALCULATIONS !!!! (only eats more memory)
//
//      RANDOMIZE NORMALS LITTLE BIT FOR GRASS (VERTEX SHADER)
//
//   ** ADD SPECIAL GRASS AND TREE PASS THAT WILL RUN IN TWO PASSES, DEPTH FIRST AND THEN EARLY-Z CULL WITH SHADERS.
//      SOLID GEOMETRY SHOULD BE RENDERED OTHER WAY SO YOU DONT HAVE TO RENDER THEM TWICE !!!!!!!!!!!!!!!!!!!!!!!!!!
//          - FIRST RENDER SOLID GEOMETRY
//          - THAN ALPHA-TESTED (TWO-PASS)
//
//      CONSIDER DOING PIXEL DISCARDING BY STENCIL-BUFFER ???????????????????
//
//		CONSIDER MOVING TBN MATRIX MULTIPLICATION (PER PIXEL) TO AFTER G-BUFFERS PART (LIGHTING)
//			YOU HAVE TO SAVE TANGENT INTO G-BUFFERS
//			MAYBE WHEN YOU MOVE NORMALMAPPING INTO LIGHTING PART YOU CAN CONTROLL WERE TO BUMP AND WHERE NO -> LOD
//
//		REMOVE REDUNDANT OPENGL COMMANDS
//
//      ADD JITTER TO PCF SHADOW SAMPLING
//      SUN SHAFTS (VOLUMETRIC SHADOW - IN FOG)
//
//  *   SUB SURFACE SCATTERING ON FOLIAGE AKA CRISIS 
//
//	*	OPENGL EXTENSION SUPPORT SYSTEM
//		ENVIROMENTAL MAPPING (REFLECTIONS)
//		SPOT LIGHT
//		MULTIPLE SPOTLIGHTS
//		6 SPOT LIGHTS AKA POINT LIGHT
//		POINTLIGHT WITHOUT SHADOW
//		STEEP PRALLAX MAPPING
//		GLASS
//		CORONA
//		SUN RAYS
//		PARTICLE SYSTEMS
//		WATER
//		VOLUMETRIC FOG
//		SKINNING
//		GI (INSTANT RADIOSITY)
//		MOTION BLUR
//		DOF
//		ANTIALIASING
//		DECALS
//		GEOMETRIC MIRROR
//
///////////////////////////////////////////////////////////////////////////////
// WEB
//		CGTEXTURES - (www.cgtextures.com : login "cauldron", password "cldr4cldr")
//
//		VBO - /http://www.sci.utah.edu/~bavoil/opengl/bavoil_trimeshes_2005.pdf
//
//      POS FROM DEPTH - http://mynameismjp.wordpress.com/2009/03/10/reconstructing-position-from-depth/
//                      http://www.phasersonkill.com/tech/?p=396
//
//      STRIPS - BLENDER - http://www.executionunit.com/blog/2010/NvStrip_and_Blender_Stripifying_Models_for_the_iPhone_iPad.html
//
//		http://assemblyrequired.crashworks.org/2008/07/08/load-hit-stores-and-the-__restrict-keyword/
//		http://www.codemaestro.com/reviews/9
//
//      SSAO BILATERAL BLUR -   http://risbrandt.blogspot.com/2007/12/power-of-vectorization.html
//                              http://www.gamedev.net/reference/programming/features/simpleSSAO/page2.asp
//
//      COMPUTE TANGENTS - http://www.3dkingdoms.com/weekly/weekly.php?a=37
//
//      G-BUFFER NORMALS - http://aras-p.info/texts/CompactNormalStorage.html
//
//      TEXTURE COMPRESSION - http://utdatabase.99k.org/files/ut99/docs/Using%20Texture%20Compression%20in%20OpenGL.pdf
//
//      CRISIS SSAO VIDEO - http://video.google.com/videoplay?docid=-2592720445119800709#
//
///////////////////////////////////////////////////////////////////////////////